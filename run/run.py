print("=" * 60)
print("–Ü–ù–°–¢–†–£–ö–¶–Ü–á –î–õ–Ø –ü–Ü–î–ì–û–¢–û–í–ö–ò RDP –í–Ü–ö–ù–ê")
print("=" * 60)

print("\n–Ü–ù–°–¢–†–£–ö–¶–Ü–Ø:")
print("1. –í—ñ–¥–∫—Ä–∏–π –≤—ñ–¥–¥–∞–ª–µ–Ω–∏–π —Ä–∞–±–æ—á–∏–π —Å—Ç—ñ–ª –∑ –ø–æ—Ç—Ä—ñ–±–Ω–∏–º–∏ –≤–∫–ª–∞–¥–∫–∞–º–∏")
print("2. –ê–∫—Ç–∏–≤—É–π –≤—ñ–∫–Ω–æ (–∫–ª—ñ–∫–Ω–∏ –≤ –Ω—å–æ–≥–æ), –ø–µ—Ä—à–µ –≤—ñ–∫–Ω–æ –∑ Latest Accession # –∫–æ–¥–æ–º")
print("3. –£ —Ç–µ–±–µ —î 15 —Å–µ–∫—É–Ω–¥ –¥–ª—è –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏")

print("\n" + "=" * 60)

import time

# –í—ñ–¥–ª—ñ–∫ 15 —Å–µ–∫—É–Ω–¥
for i in range(15, 0, -1):
    print(f"–°—Ç–∞—Ä—Ç —á–µ—Ä–µ–∑ {i} —Å–µ–∫—É–Ω–¥...")
    time.sleep(1)

print("\n‚úì –ì–û–¢–û–í–û! –ü–æ—á–∏–Ω–∞—é —Ä–æ–±–æ—Ç—É...")

# –Ü–º–ø–æ—Ä—Ç—É—î–º–æ –Ω–∞—à—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
from image_utils import SearchSettings, find_image, click_at_position
from text_utils import copy_text_from_position
from random_utils import random_sleep

def main_workflow():
    """–û—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ —Ä–æ–±–æ—Ç–∏"""
    print("\n" + "=" * 60)
    print("–ü–û–ß–ò–ù–ê–Æ –û–°–ù–û–í–ù–£ –†–û–ë–û–¢–£")
    print("=" * 60)
    
    # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ—à—É–∫—É –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
    settings = SearchSettings(
        confidence=0.7,          # –ß—É—Ç–ª–∏–≤—ñ—Å—Ç—å —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è
        grayscale=False,         # –ß/–ë –ø–æ—à—É–∫
        blur=0,                  # –†–æ–∑–º–∏—Ç—Ç—è
        scales=[0.9, 1.0, 1.1],  # –ú–∞—Å—à—Ç–∞–±–∏ –¥–ª—è –ø–æ—à—É–∫—É
        click_on="bottom",       # –ö–ª—ñ–∫–∞—Ç–∏ –≤–Ω–∏–∑—É –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
        click_offset=(0, -3),    # –ù–∞ 3 –ø—ñ–∫—Å–µ–ª—ñ –Ω–∏–∂—á–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
        max_attempts=3,          # –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–±
        search_timeout=10.0      # –¢–∞–π–º–∞—É—Ç –ø–æ—à—É–∫—É
    )
    
    # –ö–†–û–ö 1: –ü–æ—à—É–∫ —Ç–∞ –∫–ª—ñ–∫ –ø–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—é
    print("\nüîç –ö–†–û–ö 1: –®—É–∫–∞—é –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è 1.png'...")
    position = find_image("1.png", settings)
    
    if not position:
        print("‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è. –ó–∞–≤–µ—Ä—à—É—é —Ä–æ–±–æ—Ç—É.")
        return False
    
    print(f"‚úÖ –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–Ω–∞–π–¥–µ–Ω–æ –∑–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏: {position}")
    
    # –†–∞–Ω–¥–æ–º–Ω–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –º—ñ–∂ –∫—Ä–æ–∫–∞–º–∏
    random_sleep()
    
    # –ö–†–û–ö 2: –ö–ª—ñ–∫ –ø–æ –∑–Ω–∞–π–¥–µ–Ω—ñ–π –ø–æ–∑–∏—Ü—ñ—ó
    print("\nüñ±Ô∏è –ö–†–û–ö 2: –ö–ª—ñ–∫–∞—é –ø–æ –∑–Ω–∞–π–¥–µ–Ω—ñ–π –ø–æ–∑–∏—Ü—ñ—ó...")
    if not click_at_position(position):
        print("‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–ª—ñ–∫. –ó–∞–≤–µ—Ä—à—É—é —Ä–æ–±–æ—Ç—É.")
        return False
    
    print("‚úÖ –ö–ª—ñ–∫ –≤–∏–∫–æ–Ω–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ!")
    
    # –†–∞–Ω–¥–æ–º–Ω–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –º—ñ–∂ –∫—Ä–æ–∫–∞–º–∏
    random_sleep()
    
    # –ö–†–û–ö 3: –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –∑ –ø–æ–∑–∏—Ü—ñ—ó
    print("\nüìã –ö–†–û–ö 3: –ö–æ–ø—ñ—é—é —Ç–µ–∫—Å—Ç –∑ –ø–æ–∑–∏—Ü—ñ—ó...")
    copied_text = copy_text_from_position(position[0], position[1])
    
    if not copied_text:
        print("‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç. –ó–∞–≤–µ—Ä—à—É—é —Ä–æ–±–æ—Ç—É.")
        return False
    
    print(f"‚úÖ –¢–µ–∫—Å—Ç —É—Å–ø—ñ—à–Ω–æ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!")
    print(f"üìÑ –ó–º—ñ—Å—Ç —Ç–µ–∫—Å—Ç—É: {copied_text[:100]}..." if len(copied_text) > 100 else f"üìÑ –ó–º—ñ—Å—Ç —Ç–µ–∫—Å—Ç—É: {copied_text}")
    
    # –†–∞–Ω–¥–æ–º–Ω–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –º—ñ–∂ –∫—Ä–æ–∫–∞–º–∏
    random_sleep()
    
    # –ö–†–û–ö 4: –ü–æ—à—É–∫ —Ç–∞ –∫–ª—ñ–∫ –ø–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—é —Ö—Ä–æ–º –±—Ä–∞—É–∑–µ—Ä–∞
    settings = SearchSettings(
        confidence=0.7,          # –ß—É—Ç–ª–∏–≤—ñ—Å—Ç—å —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è
        grayscale=False,         # –ß/–ë –ø–æ—à—É–∫
        blur=0,                  # –†–æ–∑–º–∏—Ç—Ç—è
        scales=[0.9, 1.0, 1.1],  # –ú–∞—Å—à—Ç–∞–±–∏ –¥–ª—è –ø–æ—à—É–∫—É
        click_on="center",       # –ö–ª—ñ–∫–∞—Ç–∏
        click_offset=(0, -3),    # –ù–∞ 3 –ø—ñ–∫—Å–µ–ª—ñ –Ω–∏–∂—á–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
        max_attempts=3,          # –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ø—Ä–æ–±
        search_timeout=10.0      # –¢–∞–π–º–∞—É—Ç –ø–æ—à—É–∫—É
    )

    print("\nüîç –ö–†–û–ö 4: –®—É–∫–∞—é –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è 11.png'...")
    position = find_image("11.png", settings)
    
    if not position:
        print("‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è. –ó–∞–≤–µ—Ä—à—É—é —Ä–æ–±–æ—Ç—É.")
        return False
    
    print(f"‚úÖ –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–Ω–∞–π–¥–µ–Ω–æ –∑–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏: {position}")
    
    # –†–∞–Ω–¥–æ–º–Ω–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –º—ñ–∂ –∫—Ä–æ–∫–∞–º–∏
    random_sleep()

    # –ö–†–û–ö 5: –ö–ª—ñ–∫ –ø–æ –∑–Ω–∞–π–¥–µ–Ω—ñ–π –ø–æ–∑–∏—Ü—ñ—ó
    print("\nüñ±Ô∏è –ö–†–û–ö 5: –ö–ª—ñ–∫–∞—é –ø–æ –∑–Ω–∞–π–¥–µ–Ω—ñ–π –ø–æ–∑–∏—Ü—ñ—ó...")
    if not click_at_position(position):
        print("‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–ª—ñ–∫. –ó–∞–≤–µ—Ä—à—É—é —Ä–æ–±–æ—Ç—É.")
        return False
    
    print("‚úÖ –ö–ª—ñ–∫ –≤–∏–∫–æ–Ω–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ!")
    
    # –§—ñ–∫—Å–æ–≤–∞–Ω–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ 5 —Å–µ–∫—É–Ω–¥ –ø—ñ—Å–ª—è –∫—Ä–æ–∫—É 5
    print("\n‚è≥ –ó–∞—Ç—Ä–∏–º–∫–∞ 5 —Å–µ–∫—É–Ω–¥ –ø—ñ—Å–ª—è –∫—Ä–æ–∫—É 5...")
    time.sleep(5)
    
    return True

def handle_error(error_message: str):
    """–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫"""
    print("\n" + "=" * 60)
    print("üö® –ü–û–ú–ò–õ–ö–ê –í –†–û–ë–û–¢–Ü")
    print("=" * 60)
    print(f"–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É: {error_message}")
    print("–†–æ–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∑ –ø–æ–º–∏–ª–∫–æ—é.")
    print("=" * 60)

def main():
    """–ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è"""
    try:
        success = main_workflow()
        
        if success:
            print("\n" + "=" * 60)
            print("‚úÖ –†–û–ë–û–¢–£ –£–°–ü–Ü–®–ù–û –ó–ê–í–ï–†–®–ï–ù–û!")
            print("=" * 60)
        else:
            print("\n" + "=" * 60)
            print("‚ùå –†–û–ë–û–¢–£ –ó–ê–í–ï–†–®–ï–ù–û –ó –ü–û–ú–ò–õ–ö–ê–ú–ò")
            print("=" * 60)
            
    except Exception as e:
        handle_error(str(e))
        return False
    
    return True

if __name__ == "__main__":
    main()